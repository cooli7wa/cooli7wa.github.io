I"Ñ*<p>ä¹‹å‰çœ‹è¿‡äº† fabric æ•´ä½“çš„æ¶æ„å’Œä¸€äº›å…³é”®æ¦‚å¿µï¼Œå¯¹ fabric æœ‰äº†æ•´ä½“çš„äº†è§£ï¼Œè¿™ç¯‡ç»ˆäºå¯ä»¥ä¸Šæ‰‹äº† :)ï¼Œè¿™æ¬¡å­¦ä¹ ä¸‹ç½‘ç»œçš„æ„å»ºè¿‡ç¨‹ã€‚</p>

<p>åœ¨æ„å»ºä¹‹å‰ï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡ï¼Œæ¯”å¦‚éœ€è¦å®‰è£…å¥½ docker ç¯å¢ƒï¼Œä¸‹è½½ fabric sample å’Œ docker é•œåƒï¼Œè¿™äº›å°±ä¸è¯¦è¿°äº†ï¼Œå¯ä»¥å‚è€ƒ<a href="https://hyperledger-fabric.readthedocs.io/en/release-1.3/install.html">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>

<p>è¿™äº›å‡†å¤‡å¥½äº†ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ„å»ºç½‘ç»œã€‚</p>

<p>å…ˆè¿›å…¥ first-network ç›®å½•:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>cd fabric-samples/first-network
</pre></td></tr></tbody></table></code></pre></div></div>

<p>è¿™é‡Œæä¾›äº†ä¸€ä¸ªè„šæœ¬ byfn.shï¼Œè¿™ä¸ªè„šæœ¬ä¼šæ‰§è¡Œä¸€ç³»åˆ—çš„æ“ä½œï¼Œè¿™é‡Œçš„æ‰€æœ‰æ“ä½œåœ¨åé¢â€œæ‰‹åŠ¨æ„å»ºç½‘ç»œâ€çš„æ—¶å€™ï¼Œéƒ½ä¼šä¸€æ­¥æ­¥ç”¨åˆ°ï¼Œæ‰€ä»¥è¿™é‡Œå°±æ˜¯ç»™æˆ‘ä»¬ä¸€ä¸ªæ•´ä½“çš„å°è±¡ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°±å¯ä»¥:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre># ç”Ÿæˆç½‘ç»œç›¸å…³æ•°æ®ï¼Œè¯ä¹¦ã€genesis blockã€channel configã€anchor peer update
# genesis block åœ¨ ordering service ä¼šè¢«ä½¿ç”¨
./byfn.sh generate
# å¯åŠ¨ç½‘ç»œï¼Œè¿™é‡Œä¼šæ¯”è¾ƒä¹…ï¼Œç­‰ END å‡ºç°å°±ç»“æŸäº†
./byfn.sh up
# å…³é—­ç½‘ç»œï¼Œè¿™ä¸ªæ¯”è¾ƒå¿«
./byfn.sh down
</pre></td></tr></tbody></table></code></pre></div></div>

<p>åœ¨çœ‹å®Œåé¢çš„æ‰‹åŠ¨æ„å»ºç½‘ç»œä¹‹åï¼Œå†å›å¤´çœ‹è¿™ä¸ªæµç¨‹ä¸­æ‰“å°çš„ logï¼Œå°±å¯ä»¥å‘ç°ï¼Œå’Œæ‰‹åŠ¨æµç¨‹æ˜¯å¾ˆç±»ä¼¼çš„ã€‚</p>

<p>åœ¨åšæ‰‹åŠ¨æ„å»ºç½‘ç»œçš„æ—¶å€™ï¼Œæœ‰ä¸€ç‚¹éœ€è¦ç•™æ„ï¼Œå°±æ˜¯ä¸‹é¢æä¾›çš„å‘½ä»¤ï¼Œåœ¨ host æœºä¸Šæ‰§è¡Œçš„éƒ½æ˜¯åœ¨ first-network ç›®å½•ä¸‹æ‰§è¡Œï¼Œåœ¨ container ä¸Šæ‰§è¡Œçš„éƒ½æ˜¯åœ¨ /opt/gopath/src/github.com/hyperledger/fabric/peer ç›®å½•ä¸‹ã€‚</p>

<h3 id="æ‰‹åŠ¨æ„å»ºç½‘ç»œ">æ‰‹åŠ¨æ„å»ºç½‘ç»œ</h3>

<ol>
  <li>
    <p>ç”Ÿæˆè¯ä¹¦ç›¸å…³</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre># æ³¨æ„è¿™é‡Œæ˜¯åœ¨ first-network ç›®å½•ä¸‹æ‰§è¡Œ
../bin/cryptogen generate --config=./crypto-config.yaml
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>ç”Ÿæˆåˆ›ä¸–å—</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>export FABRIC_CFG_PATH=$PWD &amp;&amp; ../bin/configtxgen -profile TwoOrgsOrdererGenesis -outputBlock ./channel-artifacts/genesis.block
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>åˆ›å»º channel config</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>export CHANNEL_NAME=mychannel  &amp;&amp; ../bin/configtxgen -profile TwoOrgsChannel -outputCreateChannelTx ./channel-artifacts/channel.tx -channelID $CHANNEL_NAME
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>åˆ›å»º anchor peer</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre>../bin/configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org1MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org1MSP
../bin/configtxgen -profile TwoOrgsChannel -outputAnchorPeersUpdate ./channel-artifacts/Org2MSPanchors.tx -channelID $CHANNEL_NAME -asOrg Org2MSP
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>å¯åŠ¨ç½‘ç»œ</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker-compose -f docker-compose-cli.yaml up -d
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>è¿›å…¥ cli å®¹å™¨ï¼ˆé»˜è®¤æ˜¯å’Œ peer0/org1 è¿æ¥ï¼‰</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>docker exec -it cli bash
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>åˆ›å»ºå’ŒåŠ å…¥ channel</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre># è¿™é‡Œçš„ --cafile æ˜¯ä¼ å…¥ order èŠ‚ç‚¹çš„æ ¹è¯ä¹¦ï¼Œç”¨æ¥æ ¡éªŒ order èŠ‚ç‚¹
# è¿™ä¸ªå‘½ä»¤ä¼šè¿”å›ä¸€ä¸ª åˆ›ä¸– blockï¼Œç”¨æ¥åŠ å…¥ channel
export CHANNEL_NAME=mychannel
peer channel create -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/channel.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre># å°† peer0/org1 åŠ å…¥ channel
peer channel join -b mychannel.block
# å°† peer0/org2 åŠ å…¥ channelï¼Œå› ä¸ºé»˜è®¤æ˜¯ä¸ peer0/org1 è¿æ¥ï¼Œè¿™é‡Œéœ€è¦å‰ç½®ä¸‹ç¯å¢ƒå˜é‡
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp  CORE_PEER_ADDRESS=peer0.org2.example.com:7051 
CORE_PEER_LOCALMSPID="Org2MSP" 
CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt
peer channel join -b mychannel.block
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>æ›´æ–° anchor peer</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre># update peer0/org1
peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/Org1MSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
# update peer0/org2
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_ADDRESS=peer0.org2.example.com:7051 CORE_PEER_LOCALMSPID="Org2MSP" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt peer channel update -o orderer.example.com:7050 -c $CHANNEL_NAME -f ./channel-artifacts/Org2MSPanchors.tx --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>å®‰è£…å’Œå®ä¾‹åŒ– chaincode</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre># å®‰è£…ï¼Œè¿™æ¡æ˜¯åœ¨ peer0/org1 å®‰è£…äº† chaincodeï¼Œ-n æ˜¯åå­—ï¼Œ-v æ˜¯ç‰ˆæœ¬
peer chaincode install -n mycc -v 1.0 -p github.com/chaincode/chaincode_example02/go/
# åœ¨ peer0/org2 ä¹Ÿéœ€è¦å®‰è£…ï¼Œéœ€è¦å‰ç½®ä¸‹ç¯å¢ƒå˜é‡
CORE_PEER_MSPCONFIGPATH=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/users/Admin@org2.example.com/msp CORE_PEER_ADDRESS=peer0.org2.example.com:7051 CORE_PEER_LOCALMSPID="Org2MSP" CORE_PEER_TLS_ROOTCERT_FILE=/opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt peer chaincode install -n mycc -v 1.0 -p github.com/chaincode/chaincode_example02/go/
# å®ä¾‹åŒ–ï¼Œ-P æ˜¯ä»£è¡¨éœ€è¦ org1 å’Œ org2 ä¸€èµ·èƒŒä¹¦
peer chaincode instantiate -o orderer.example.com:7050 --tls --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n mycc -v 1.0 -c '{"Args":["init","a", "100", "b","200"]}' -P "AND ('Org1MSP.peer','Org2MSP.peer')"
</pre></td></tr></tbody></table></code></pre></div>    </div>
  </li>
  <li>
    <p>query å’Œ invoke</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre># queryï¼Œè·å– a çš„å€¼ï¼Œè¿”å› 100
peer chaincode query -C $CHANNEL_NAME -n mycc -c '{"Args":["query","a"]}'
# invokeï¼Œa ç»™ b 10ï¼Œè¿™é‡Œéœ€è¦æä¾› order org1 org2 çš„è¯ä¹¦
peer chaincode invoke -o orderer.example.com:7050 --tls true --cafile /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/ordererOrganizations/example.com/orderers/orderer.example.com/msp/tlscacerts/tlsca.example.com-cert.pem -C $CHANNEL_NAME -n mycc --peerAddresses peer0.org1.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org1.example.com/peers/peer0.org1.example.com/tls/ca.crt --peerAddresses peer0.org2.example.com:7051 --tlsRootCertFiles /opt/gopath/src/github.com/hyperledger/fabric/peer/crypto/peerOrganizations/org2.example.com/peers/peer0.org2.example.com/tls/ca.crt -c '{"Args":["invoke","a","b","10"]}'
</pre></td></tr></tbody></table></code></pre></div>    </div>

    <p>è¿™é‡Œ a b çš„å€¼å¯ä»¥æ˜¯è´Ÿå€¼</p>
  </li>
</ol>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>

:ET